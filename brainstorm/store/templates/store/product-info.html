
{% extends "./base.html" %}


{%load custom_filters %}
{% load static %}
{% load humanize %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<style>
    /* Style the review form container */
    .review-form-container {
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

    /* Style the form elements */
    .review-form-container h2 {
        font-size: 24px;
        margin-bottom: 20px;
    }

    .review-form-container form {
        max-width: 400px; /* Adjust the maximum width as needed */
        margin: 0 auto;
    }

    .review-form-container form label {
        font-weight: bold;
    }

    .review-form-container form .submit-button {
        background-color: #007bff;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }


</style>
<div class="container">

    <main class="pt-5">

        <div class="row g-3">

            <div class="col-md-5 col-lg-5 order-md-first bg-light">
            
                <img class="img-fluid mx-auto d-block" alt="Responsive image" src="{{ product.image.url }}"> <!-- Product image -->
            
            </div>

            <div class="col-md-7 col-lg-7 ps-md-3 ps-lg-5">

                <h1 class="mb-0 h4"> {{product.title}}<!-- Product title -->  </h1>

                <strong> {{product.brand}} <!-- Product brand --> </strong>


                <hr>

                <br>


                <p> {{product.description}} <!-- Product description --> </p>

                <div class="border">

                    <div class="col border-bottom">

                        <div class="row p-3">

                            <div class="col-6"> Price </div>

                            <div class="col-6 text-end"><span class="h4 fw-bold">$  {{ product.price|intcomma }} <!-- Product price --> </span></div>

                        </div>

                    </div>

                    <div class="col">
              
                        <div class="row p-3">
              
                            <div class="col-6">
              
                               
                                <label for="select">Qty</label>
                                
                                &nbsp; 
                               
                                <select id="select">
                                    
                                    {% for quantity in available_quantities %}
                                    {%if quantity > 4%}
                                    {%else%}
                                    <option value="{{ quantity }}">{{ quantity }}</option>
                                    {%endif%}
                                    {% endfor %}
              
                                </select>
                                <p>Available Stock: {{ product.quantity }}</p>

                            </div>

                            <div class="col-6 text-end">

                                
                            {% if product.quantity > 0 %}
                            <form method="post" class="add-to-cart-form">
                            {% csrf_token %}
                            <button type="button" id="add-button" value="{{product.id}}" class="btn btn-secondary btn-sm">
                        
                                Add to cart 
                            
                            </button>                             
                            </form>
                            {% else %}
                            <p class="text-danger">Out of stock</p>
                            {% endif %}
                                
                                
                            

                            </div>
                        
                        </div>

                    </div>

                </div>

            </div>

        </div>

        <div class="review-form-container">
        {% if user.is_authenticated %}
        <h2>Add a Review</h2>
        <form method="post" action="{% url 'add_review' product.slug %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="{{ review_form.rating.id_for_label }}">Rating:</label>
                <input type="number" name="{{ review_form.rating.name }}" id="{{ review_form.rating.id_for_label }}" min="1" max="5" required>
            </div>
            <div class="form-group">
                <label for="{{ review_form.comment.id_for_label }}">Comment:</label>
                {{ review_form.comment }}
            </div>
            <button type="submit" class="submit-button">Submit Review</button>
        </form>
        {%endif%}

        <h3>Product Reviews</h3>
        <ul>
            {% for review in reviews %}
                <li>
                    <strong>{{ review.user.username }}:</strong> {{ review.comment }} (Rating:
                    {% for i in review.rating|get_range %}
                        <i class="fas fa-star"></i>
                    {% endfor %}
                    {% for i in review.rating|get_inverse_range %}
                        <i class="far fa-star"></i>
                    {% endfor %})
                </li>
            {% empty %}
                <li>No reviews yet.</li>
            {% endfor %}
        </ul>
        
        
        
        </div>



    </main>

    <br>

</div>


<script>

    $(document).on('click', '#add-button', function(e){

        e.preventDefault();

        $.ajax({

            type: 'POST',
            url: '{% url "cart-add" %}',
            data: {

                product_id: $('#add-button').val(),
                product_quantity: $('#select option:selected').text(),
                csrfmiddlewaretoken: "{{csrf_token}}",
                action: 'post'
            },

            success: function(json){

                //console.log(json)

                document.getElementById("cart-qty").textContent = json.qty


            },

            error: function(xhr, errmsg, err){


            }


        });




    })





</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const stars = document.querySelectorAll(".star");
        stars.forEach((star, index) => {
            star.addEventListener("click", () => {
                // Set the rating based on the clicked star's index
                const rating = index + 1;
                // You can update your form with this rating value
                console.log(`You rated with ${rating} stars.`);
            });
        });
    });
</script>

{% endblock %}
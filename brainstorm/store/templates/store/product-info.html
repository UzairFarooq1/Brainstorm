
{% extends "./base.html" %}

{% load static %}
{% load humanize %}
{% block content %}

<div class="container">

    <main class="pt-5">

        <div class="row g-3">

            <div class="col-md-5 col-lg-5 order-md-first bg-light">
            
                <img class="img-fluid mx-auto d-block" alt="Responsive image" src="{{ product.image.url }}"> <!-- Product image -->
            
            </div>

            <div class="col-md-7 col-lg-7 ps-md-3 ps-lg-5">

                <h1 class="mb-0 h4"> {{product.title}}<!-- Product title -->  </h1>

                <strong> {{product.brand}} <!-- Product brand --> </strong>


                <hr>

                <br>


                <p> {{product.description}} <!-- Product description --> </p>

                <div class="border">

                    <div class="col border-bottom">

                        <div class="row p-3">

                            <div class="col-6"> Price </div>

                            <div class="col-6 text-end"><span class="h4 fw-bold">$  {{ product.price|intcomma }} <!-- Product price --> </span></div>

                        </div>

                    </div>

                    <div class="col">
              
                        <div class="row p-3">
              
                            <div class="col-6">
              
                               
                                <label for="select">Qty</label>
                                
                                &nbsp; 
                               
                                <select id="select">
                                    
                                    {% for quantity in available_quantities %}
                                    {%if quantity > 4%}
                                    {%else%}
                                    <option value="{{ quantity }}">{{ quantity }}</option>
                                    {%endif%}
                                    {% endfor %}
              
                                </select>
                                <p>Available Stock: {{ product.quantity }}</p>

                            </div>

                            <div class="col-6 text-end">

                                
                            {% if product.quantity > 0 %}
                            <form method="post" class="add-to-cart-form">
                            {% csrf_token %}
                            <button type="button" id="add-button" value="{{product.id}}" class="btn btn-secondary btn-sm">
                        
                                Add to cart 
                            
                            </button>                             
                            </form>
                            {% else %}
                            <p class="text-danger">Out of stock</p>
                            {% endif %}
                                
                                
                            

                            </div>
                        
                        </div>

                    </div>

                </div>

            </div>

        </div>

    </main>

    <br>

</div>


<script>

    $(document).on('click', '#add-button', function(e){

        e.preventDefault();

        $.ajax({

            type: 'POST',
            url: '{% url "cart-add" %}',
            data: {

                product_id: $('#add-button').val(),
                product_quantity: $('#select option:selected').text(),
                csrfmiddlewaretoken: "{{csrf_token}}",
                action: 'post'
            },

            success: function(json){

                //console.log(json)

                document.getElementById("cart-qty").textContent = json.qty


            },

            error: function(xhr, errmsg, err){


            }


        });




    })





</script>

{% endblock %}